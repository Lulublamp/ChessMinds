image: node:19.6

before_script:
  - apt-get update && apt-get install -y curl
  - curl -sL https://deb.nodesource.com/setup_19.x | bash -
  - apt-get install -y nodejs
  - yarn install -y
  - mkdir front-build/
  - mkdir core-build/
  - mkdir backend-build/
  - mkdir client-build/

stages:
  - build

frontend:
  stage: build
  script:
    - yarn workspace @TRPI/frontend build
    - rm -R ./front-build && mkdir front-build/
    - cp -r ./apps/frontend/dist  ./front-build/ || true
    - echo "front build"
    - ls
    - ls ./front-build

# backend:
#   stage: build
#   script:
#     - cd backend
#     - yarn install
#     - yarn build

# client:
#   stage: build
#   script:
#     - cd client
#     - yarn install
#     - yarn build

# core:
#   stage: build
#   script:
#     - cd core
#     - yarn install
#     - yarn build


# deploy:
#   stage: deploy
#   script:
#     - echo 'deploy test'
#   only:
#     - master
# server:
#   stage: server
#   script:
#     - ssh vmProjetIntegrateurgrp0-1
#     - echo 'server build'
#   only:
#     changes:
#       - apps/backend/**/*
#   dependencies:
#     - ssh-prepare

# front:
#   stage: front
#   script:
#     - ssh vmProjetIntegrateurgrp0-1
#     - echo 'front build'
#   only:
#     changes:
#       - apps/frontend/**/*
#   dependencies:
#     - ssh-prepare