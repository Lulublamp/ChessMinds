import React, { useEffect } from "react";
import "./PlayerContainerStyle.css"
import PlayerIconTEMPORAIRE from "../../images/IconPlayer.png";
import { useFPayload, useGameManager, usePlayerIsWhite } from "../../contexts/GameContext";
import { JoinQueuOption } from "@TRPI/core/core-network/src/MatchMaking";
import { MATCHMAKING_MODES_TIMERS } from "@TRPI/core/core-network";


interface PlayerContainerProps {
  isWhitePlayer: boolean;
  playerName: string | undefined;
  playerScore: number | undefined;
  playerScorePieceValue: number;
  time: string;
  enHaut: boolean;
}

function optionToTime(option: JoinQueuOption){

  switch (option.timer) {
    case MATCHMAKING_MODES_TIMERS.BLITZ:
      return '3:00';
    case MATCHMAKING_MODES_TIMERS.BULLET:
      return '1:00';
    case MATCHMAKING_MODES_TIMERS.RAPID:
      return '5:00';
  }

}

const PlayerContainer: React.FC<PlayerContainerProps> = ({
  isWhitePlayer,
  playerName,
  playerScore,
  playerScorePieceValue,
  time,
  enHaut
}) => {
  const fpayload = useFPayload();
  const [gameManager , setGameManager] = useGameManager();
  const [timer , setTimer] = React.useState(fpayload?.options.timer.toString());
  const playerIsWhite = usePlayerIsWhite()

  useEffect(() => {
    console.log('payload changed');
  }, [fpayload])  

  

  useEffect(() => {
    if (gameManager) {
      console.log(isWhitePlayer)
      gameManager.listenToTime({
        timeSetter: setTimer,
        time: timer,
        id: isWhitePlayer ? enHaut ? 'white' : 'black' : enHaut ? 'black' : 'white',
      })
    }

  }, [gameManager])


  return (
    <div className={`playerContainer ${isWhitePlayer ? "whitePlayer" : "blackPlayer"}`}>
      <div>
        <div>
          <img src={PlayerIconTEMPORAIRE} alt="Player Icon" />
          <div>
            <span>{playerName}</span>
            <span>{playerScore}</span>
          </div>
        </div>
        <div>
          <svg width="24" height="25" viewBox="0 0 24 25" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <path
              d="M12.9995 13.4314H14.9995C15.2647 13.4314 15.5191 13.5368 15.7066 13.7243C15.8942 13.9118 15.9995 14.1662 15.9995 14.4314C15.9995 14.6966 15.8942 14.951 15.7066 15.1385C15.5191 15.326 15.2647 15.4314 14.9995 15.4314H11.9995C11.8681 15.4318 11.7379 15.4062 11.6164 15.3561C11.4949 15.306 11.3845 15.2323 11.2915 15.1394C11.1986 15.0464 11.125 14.9361 11.0748 14.8145C11.0247 14.693 10.9991 14.5628 10.9995 14.4314V10.4314C10.9995 10.1662 11.1049 9.91183 11.2924 9.72429C11.48 9.53675 11.7343 9.4314 11.9995 9.4314C12.2647 9.4314 12.5191 9.53675 12.7066 9.72429C12.8942 9.91183 12.9995 10.1662 12.9995 10.4314V13.4314ZM5.86853 9.2924C5.64004 9.18643 5.44191 9.02463 5.29242 8.82193C5.14293 8.61923 5.04689 8.38215 5.01315 8.13255C4.97941 7.88296 5.00907 7.62888 5.09938 7.39377C5.18969 7.15865 5.33775 6.95006 5.5299 6.78723C5.72206 6.6244 5.95212 6.51258 6.19887 6.46208C6.44562 6.41158 6.70111 6.42403 6.94179 6.49827C7.18246 6.57251 7.40057 6.70616 7.57599 6.88689C7.75141 7.06762 7.87849 7.28962 7.94553 7.5324C8.3059 7.32047 8.6824 7.13724 9.07153 6.9844C8.63419 6.6805 8.30533 6.24488 8.13286 5.74102C7.96039 5.23716 7.95333 4.69139 8.1127 4.18323C8.27208 3.67508 8.58957 3.2311 9.0189 2.91599C9.44823 2.60088 9.96697 2.4311 10.4995 2.4314H13.4995C14.0321 2.4311 14.5508 2.60088 14.9802 2.91599C15.4095 3.2311 15.727 3.67508 15.8864 4.18323C16.0457 4.69139 16.0387 5.23716 15.8662 5.74102C15.6937 6.24488 15.3649 6.6805 14.9275 6.9844C15.3175 7.1384 15.6945 7.3214 16.0535 7.5324C16.1206 7.28962 16.2476 7.06762 16.4231 6.88689C16.5985 6.70616 16.8166 6.57251 17.0573 6.49827C17.2979 6.42403 17.5534 6.41158 17.8002 6.46208C18.0469 6.51258 18.277 6.6244 18.4692 6.78723C18.6613 6.95006 18.8094 7.15865 18.8997 7.39377C18.99 7.62888 19.0196 7.88296 18.9859 8.13255C18.9522 8.38215 18.8561 8.61923 18.7066 8.82193C18.5571 9.02463 18.359 9.18643 18.1305 9.2924C19.1084 10.4592 19.733 11.8809 19.9311 13.3904C20.1291 14.8999 19.8923 16.4345 19.2485 17.8141C18.6046 19.1937 17.5805 20.3609 16.2964 21.1787C15.0123 21.9965 13.5215 22.4309 11.999 22.4309C10.4766 22.4309 8.98579 21.9965 7.70166 21.1787C6.41754 20.3609 5.39343 19.1937 4.7496 17.8141C4.10577 16.4345 3.86897 14.8999 4.06699 13.3904C4.26501 11.8809 4.89065 10.4592 5.86853 9.2924ZM11.9995 20.4314C13.5908 20.4314 15.117 19.7993 16.2422 18.674C17.3674 17.5488 17.9995 16.0227 17.9995 14.4314C17.9995 12.8401 17.3674 11.314 16.2422 10.1888C15.117 9.06354 13.5908 8.4314 11.9995 8.4314C10.4082 8.4314 8.88211 9.06354 7.75689 10.1888C6.63167 11.314 5.99953 12.8401 5.99953 14.4314C5.99953 16.0227 6.63167 17.5488 7.75689 18.674C8.88211 19.7993 10.4082 20.4314 11.9995 20.4314ZM10.4995 4.4314C10.3669 4.4314 10.2397 4.48408 10.146 4.57784C10.0522 4.67161 9.99953 4.79879 9.99953 4.9314C9.99953 5.06401 10.0522 5.19118 10.146 5.28495C10.2397 5.37872 10.3669 5.4314 10.4995 5.4314H13.4995C13.6321 5.4314 13.7593 5.37872 13.8531 5.28495C13.9468 5.19118 13.9995 5.06401 13.9995 4.9314C13.9995 4.79879 13.9468 4.67161 13.8531 4.57784C13.7593 4.48408 13.6321 4.4314 13.4995 4.4314H10.4995Z"
              fill="black" />
          </svg>
          <span className="time">{timer}</span>
        </div>
      </div>
      <div>
        <svg width="45" height="48" viewBox="0 0 45 48" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M14.4422 27.4314C14.1439 27.8591 13.788 28.3045 13.3732 28.7627C11.9091 30.3797 10.1135 31.7101 8.9546 32.4057L8.75965 32.5227C7.98071 32.9902 7.5 33.8603 7.5 34.8027V41.1347C7.5 42.585 8.61929 43.7607 10 43.7607H34.375C35.7557 43.7607 36.875 42.585 36.875 41.1347V34.8027C36.875 33.8603 36.3943 32.9902 35.6154 32.5227L35.4204 32.4057C34.2615 31.7101 32.4659 30.3797 31.0018 28.7627C30.587 28.3045 30.2311 27.8591 29.9328 27.4314C31.03 27.1538 31.8452 26.1161 31.8452 24.8783V20.6037C31.8452 19.7504 31.4506 18.9504 30.7869 18.4583L29.7251 17.671C30.3378 16.4206 30.6845 15.0017 30.6845 13.4989C30.6845 8.45735 26.7937 4.37036 21.994 4.37036C17.1944 4.37036 13.3036 8.45735 13.3036 13.4989C13.3036 15.0862 13.6903 16.5795 14.3684 17.8797L13.5881 18.4583C12.9244 18.9504 12.5298 19.7504 12.5298 20.6037V24.8783C12.5298 26.1161 13.345 27.1538 14.4422 27.4314Z"
            fill="#272727" />
          <path
            d="M28.1845 13.4989C28.1845 15.3848 27.4202 17.0832 26.1992 18.2709L29.3452 20.6036V24.8783H26.2654C26.4139 26.8597 27.6242 28.8427 29.1903 30.5724C30.8524 32.408 32.8521 33.8885 34.1801 34.6856L34.375 34.8026V41.1346H10V34.8026L10.1949 34.6856C11.5229 33.8885 13.5226 32.408 15.1847 30.5724C16.7508 28.8427 17.9611 26.8597 18.1097 24.8783H15.0298V20.6036L17.9598 18.4311C16.6396 17.2386 15.8036 15.4713 15.8036 13.4989C15.8036 9.90762 18.5751 6.99634 21.994 6.99634C25.413 6.99634 28.1845 9.90762 28.1845 13.4989Z"
            fill="#F4F7FA" />
        </svg>
        <svg width="45" height="48" viewBox="0 0 45 48" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M14.4422 27.4314C14.1439 27.8591 13.788 28.3045 13.3732 28.7627C11.9091 30.3797 10.1135 31.7101 8.9546 32.4057L8.75965 32.5227C7.98071 32.9902 7.5 33.8603 7.5 34.8027V41.1347C7.5 42.585 8.61929 43.7607 10 43.7607H34.375C35.7557 43.7607 36.875 42.585 36.875 41.1347V34.8027C36.875 33.8603 36.3943 32.9902 35.6154 32.5227L35.4204 32.4057C34.2615 31.7101 32.4659 30.3797 31.0018 28.7627C30.587 28.3045 30.2311 27.8591 29.9328 27.4314C31.03 27.1538 31.8452 26.1161 31.8452 24.8783V20.6037C31.8452 19.7504 31.4506 18.9504 30.7869 18.4583L29.7251 17.671C30.3378 16.4206 30.6845 15.0017 30.6845 13.4989C30.6845 8.45735 26.7937 4.37036 21.994 4.37036C17.1944 4.37036 13.3036 8.45735 13.3036 13.4989C13.3036 15.0862 13.6903 16.5795 14.3684 17.8797L13.5881 18.4583C12.9244 18.9504 12.5298 19.7504 12.5298 20.6037V24.8783C12.5298 26.1161 13.345 27.1538 14.4422 27.4314Z"
            fill="#272727" />
          <path
            d="M28.1845 13.4989C28.1845 15.3848 27.4202 17.0832 26.1992 18.2709L29.3452 20.6036V24.8783H26.2654C26.4139 26.8597 27.6242 28.8427 29.1903 30.5724C30.8524 32.408 32.8521 33.8885 34.1801 34.6856L34.375 34.8026V41.1346H10V34.8026L10.1949 34.6856C11.5229 33.8885 13.5226 32.408 15.1847 30.5724C16.7508 28.8427 17.9611 26.8597 18.1097 24.8783H15.0298V20.6036L17.9598 18.4311C16.6396 17.2386 15.8036 15.4713 15.8036 13.4989C15.8036 9.90762 18.5751 6.99634 21.994 6.99634C25.413 6.99634 28.1845 9.90762 28.1845 13.4989Z"
            fill="#F4F7FA" />
        </svg>
        <span className="scorePieceValue">{`+${playerScorePieceValue}`}</span>
      </div>
    </div>
  );
};

export default PlayerContainer;
